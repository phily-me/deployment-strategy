#!/bin/bash

# Development environment setup via direnv
# Uses modular scripts for better maintainability and testing

# Load configuration
if [[ -f ".env" ]]; then
    set -a
    source .env
    set +a
fi

# Check if nix is available and flake exists
if command -v nix >/dev/null 2>&1 && [[ -f "$FLAKE_FILE" ]]; then
    echo "üöÄ Using Nix development environment"
    use flake
else
    echo "‚ö†Ô∏è  Nix not available, building Docker development container"
    echo "   Run 'docker exec -it $DEV_CONTAINER_NAME nix develop' to enter the development shell"
    
    # Use the Docker setup script to build image and start container
    if ! ./scripts/docker-dev-setup.sh setup "$(pwd)"; then
        echo "‚ùå Failed to setup development environment"
        exit 1
    fi
fi